<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lingyuecm.mapper.RoleMapper">
    <select id="selectAllRoles"
            resultType="com.lingyuecm.dto.ConfRoleDto">
        SELECT ROLE_ID AS roleId,
               ROLE_NAME AS roleName
        FROM CONF_ROLE
        WHERE ENABLED = 1;
    </select>
    <select id="selectUserRoles"
            resultType="com.lingyuecm.dto.ConfRoleDto">
        SELECT m.ROLE_ID AS roleId,
               r.ROLE_NAME AS roleName
        FROM (SELECT USER_ID,
                     ROLE_ID
              FROM MAP_USER_ROLE
              WHERE USER_ID = #{userId}) m
        LEFT JOIN CONF_ROLE r ON m.ROLE_ID = r.ROLE_ID;
    </select>
    <delete id="deleteUserRoles">
        DELETE FROM MAP_USER_ROLE
        WHERE USER_ID = #{userId};
    </delete>
    <insert id="insertUserRoles">
        INSERT INTO MAP_USER_ROLE
        (
         USER_ID,
         ROLE_ID
        )
        VALUES
        <foreach collection="roleIds" item="roleId" open="" separator="," close="">
            (#{userId}, #{roleId})
        </foreach>;
    </insert>
</mapper>